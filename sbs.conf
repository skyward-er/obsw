# Skyward Build System Configuration File
#
# Copyright (c) 2015-2019 Skyward Experimental Rocketry
# Authors: Alain Carlucci, Alvise de' Faveri Tron
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in
# all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
# THE SOFTWARE.
#
# Here's a list of available BoardIds:
#lpc2138_miosix_board
#stm32f103ze_stm3210e-eval
#stm32f103ve_mp3v2
#stm32f100rb_stm32vldiscovery
#stm32f103ve_strive_mini
#stm32f103ze_redbull_v2
#stm32f407vg_stm32f4discovery
#stm32f207ig_stm3220g-eval
#stm32f207zg_ethboard_v2
#stm32f207ze_als_camboard
#stm32l151_als_mainboard
#stm32f407vg_bitsboard
#stm32f205rg_sony-newman
#stm32f429zi_stm32f4discovery
#stm32f103cb_als_mainboard_rev2
#stm32f100cb_tempsensor
#stm32f429zi_oledboard2
#efm32gg332f1024_wandstem
#stm32f411re_nucleo
#stm32f429zi_skyward_anakin
#stm32f100rc_solertegiard
#stm32f205rc_skyward_stormtrooper
#stm32f401vc_stm32f4discovery
#stm32f103c8_breakout
#stm32f100c8_microboard
#stm32f469ni_stm32f469i-disco
#stm32f429zi_skyward_death_stack
#stm32f401re_nucleo
#stm32f103c8_skyward_aldeeran


# Syntax of this file:
# SBS_PROJECT: project settings
# srcfiles:    groups of sources to be compiled together
# boards:      main files, located in ENTRY_PATH
# tests:       test files, located in TESTS_PATH

#-----------------------------------#
#            SBS Project            #
#-----------------------------------#
# ENTRY_PATH:       entrypoints folder realative path
# TESTS_PATH:       tests folder realative path
# SRC_PATH:         shared sources folder realative path
# SBS_BASE:         boardcore folder relative path
# PROJECT_INCLUDES: Optional additional include directories, preceeded by -I (eg: -Ilibs/mxgui)
# PROJECT_SUBDIRS:  Optional subfolders which contains additional makefiles (eg: libs/mxgui)
# PROJECT_LIBS:     Optional static libraries. (eg: libs/mxgui/mxgui.a)

[SBS_PROJECT]
Type:             project
ENTRY_PATH:       src/entrypoints
TESTS_PATH:       src/tests
SRC_PATH:         src
SBS_BASE:         skyward-boardcore
PROJECT_INCLUDES: -Isrc/boards/DeathStack
                  -Iskyward-boardcore/src/shared
                  -Iskyward-boardcore
                  -Iskyward-boardcore/libs/mavlink_skyward_lib
PROJECT_SUBDIRS:
PROJECT_LIBS:

#-----------------------------------#
#          List of Sources          #
#-----------------------------------#
# [name]    -> can be included by boards and tests using '%name'
#     Type: srcfiles
#     Files: a '\n'-separated list of f

[deathstack]
Type:       srcfiles
Files:      src/boards/DeathStack/LoggerService/LoggerService.cpp
            src/boards/DeathStack/events/EventStrings.cpp
            src/boards/DeathStack/FlightModeManager/FlightModeManager.cpp
            src/boards/DeathStack/SensorManager/SensorManager.cpp
            src/boards/DeathStack/DeploymentController/DeploymentController.cpp
            src/boards/DeathStack/DeploymentController/Motor/MotorDriver.cpp
            src/boards/DeathStack/PinHandler/PinHandler.cpp
            src/boards/DeathStack/TMTCManager/TMTCManager.cpp
            src/boards/DeathStack/LoggerService/TmRepository.cpp
            src/boards/DeathStack/ADA/ADAController.cpp
            src/boards/DeathStack/ADA/ADA.cpp
            src/boards/DeathStack/ADA/ADACalibrator.cpp
            src/boards/DeathStack/ADA/DeploymentUtils/generated/elevation_map_data.cpp
            src/boards/DeathStack/ADA/DeploymentUtils/elevation_map.cpp
            src/boards/DeathStack/LoggerService/FlightStatsRecorder.cpp
            src/boards/DeathStack/TMTCManager/XbeeInterrupt.cpp

[ada]
Type:       srcfiles
Files:      src/boards/DeathStack/ADA/ADAController.cpp
            src/boards/DeathStack/ADA/ADA.cpp
            src/boards/DeathStack/ADA/ADACalibrator.cpp
            src/boards/DeathStack/ADA/DeploymentUtils/generated/elevation_map_data.cpp
            src/boards/DeathStack/ADA/DeploymentUtils/elevation_map.cpp

[deployment]
Type:       srcfiles
Files:      src/boards/DeathStack/DeploymentController/Motor/MotorDriver.cpp
            src/boards/DeathStack/DeploymentController/DeploymentController.cpp

[fmm]
Type:       srcfiles
Files:      src/boards/DeathStack/FlightModeManager/FlightModeManager.cpp

[sensors]
Type:       srcfiles
Files:      src/boards/DeathStack/SensorManager/SensorManager.cpp

[tmtc]
Type:       srcfiles
Files:      src/boards/DeathStack/TMTCManager/TMTCManager.cpp
            src/boards/DeathStack/TMTCManager/XbeeInterrupt.cpp

[aldeeran]
Type:       srcfiles
Files:      src/boards/Ignition/IgnitionManager.cpp

[logservice]
Type:       srcfiles
Files:      src/boards/DeathStack/LoggerService/LoggerService.cpp
            src/boards/DeathStack/LoggerService/TmRepository.cpp

[logger-hermes]
Type:       srcfiles
Files:      src/boards/DeathStack/LoggerService/FlightStatsRecorder.cpp

[ada-test-sources]
Type:       srcfiles
Files:      src/tests/catch/ada/ada_kalman_p/test-ada-data.cpp
            src/boards/DeathStack/ADA/DeploymentUtils/generated/tests/elevation_map_test_data.cpp

[kalman-test-sources]
Type:       srcfiles
Files:      src/tests/catch/ada/kalman_acc/test-kalman-acc-data.cpp

[mock-sensors-data]
Type:       srcfiles
Files:      src/tests/mock_sensors/test-mock-data.cpp

[hermes-tests]
Type:       srcfiles
Files:      src/tests/catch/fsm/test-ada.cpp

[ram-test]
Type:       srcfiles
Files:      src/tests/ram_test/sha1.cpp

[evt-functions]
Type:       srcfiles
Files:      src/boards/DeathStack/events/EventStrings.cpp

#--------------------------#
#          Boards          #
#--------------------------#
# [boardname]  -> compile using './sbs -b boardname'
#     BoardId: see the list at the top of this file
#     BinName: name of the final binary (without extension!)
#     Include: a space-separated list of files, %something will be substituted
#              with the corresponding 'srcfiles'
#     Main:    name of the main file (e.g. 'foo' -> src/entrypoints/foo.cpp)

[death-stack-entry]
Type:       board
BoardId:    stm32f429zi_skyward_death_stack
BinName:    death-stack-entry
Include:    %shared %deathstack %logger %pwm %xbee %piksi %servo %mock-sensors-data
Defines:    -DDEATH_STACK_1 -DUSE_MOCK_SENSORS
Main:       death-stack-entry

[death-stack-testsuite]
Type:       board
BoardId:    stm32f429zi_skyward_death_stack
BinName:    death-stack-testsuite
Include:    %shared %deathstack %logger %pwm %xbee %piksi %servo
Defines:    -DDEATH_STACK_1
Main:       death-stack-testsuite

#--------------------------#
#          Tests           #
#--------------------------#
# [testname]   -> compile using './sbs -b testname'
#     BoardId: see the list at the top of this file
#     BinName: name of the final binary (without extension!)
#     Include: a space-separated list of files, %something will be substituted
#              with the corresponding 'srcfiles'
#     Main:    name of the main file (e.g. 'foo' -> src/tests/foo.cpp)

[catch-tests-entry]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    catch-tests-entry
Include:    %shared %deathstack %logger %pwm %xbee %piksi %servo %hermes-tests
Defines:    -DDEATH_STACK_1
Main:       catch/catch-tests-entry

## Driver tests

[test-imus]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-imus
Include:    %shared %sensors %logger %logger-hermes
Defines:    -DDEATH_STACK_1
Main:       drivers/test-imus

[test-cutter]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-cutter
Include:    %pwm
Defines:    -DDEBUG -DDEATH_STACK_1
Main:       drivers/test-cutter

[test-mavlink]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-mavlink
Include:    %shared %tmtc %logger %logger-hermes %xbee %logservice
Defines:    -DDEBUG -DTRACE_EVENTS -DDEATH_STACK_1
Main:       drivers/test-mavlink

[ledwave]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    ledwave
Include:    %shared
Defines:    -DDEBUG
Main:       ledwave

[ramtest]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    ramtest
Include:    %ram-test
Defines:
Main:       ram_test/main

[test-motor]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-motor
Include:    %shared %deployment %pwm %servo
Defines:
Main:       drivers/test-motor

[test-servo]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-servo
Include:    %shared %servo %pwm
Defines:
Main:       drivers/test-servo

[test-all-sensors]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-all-sensors
Include:    %shared %logger %piksi
Defines:    -DDEATH_STACK_1
Main:       drivers/test-all-sensors

[test-pressure-calib]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-pressure-calib
Include:    %shared %logger %piksi
Defines:    -DDEATH_STACK_1
Main:       drivers/test-pressure-calib

[test-power-board]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-power-board
Include:    %shared
Defines:    -DDEBUG
Main:       drivers/test-power-board

## Component tests

# Cant use this as it is since the DeathStack singleton is required for handling messages in the TCHandler class
# [test-tmtc]
# Type:       test
# BoardId:    stm32f429zi_skyward_death_stack
# BinName:    test-tmtc
# Include:    %shared %tmtc %logger %logger-hermes %xbee %evt-functions %logproxy
# Defines:    -DDEBUG -DTRACE_EVENTS
# Main:       test-tmtc

# [test-canproxy]
# Type:       test
# BoardId:    stm32f429zi_skyward_death_stack
# BinName:    test-canproxy
# Include:    %shared %canproxy %logger %logger-hermes %canbus
# Defines:    -DDEBUG
# Main:       test-canproxy

[test-logproxy]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-logproxy
Include:    %shared %logger %logger-hermes %logservice
Defines:    -DDEBUG -DDEATH_STACK_1
Main:       test-logproxy

[test-sensormanager]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-sensormanager
Include:    %shared %sensors %logger %logger-hermes %ada %piksi %logservice %ada-test-sources
Defines:    -DDEBUG -USE_MOCK_SENSORS -DDEATH_STACK_1
Main:       test-sensormanager

#Cant use this as it is since the DeathStack singleton is required for handling messages in the TCHandler class
# [test-sm+tmtc]
# Type:       test
# BoardId:    stm32f429zi_skyward_death_stack
# BinName:    test-sm+tmtc
# Include:    %shared %sensors %logger %logservice %logger-hermes %ada %piksi %tmtc %xbee %evt-functions %ada-test-sources
# Defines:    -DDEBUG -DDEATH_STACK_1
# Main:       test-sm+tmtc

[test-dpl]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-dpl
Include:    %shared %deathstack %logger %pwm %xbee %piksi %servo %test-utils
Defines:    -DDEBUG -DTRACE_EVENTS -DDEATH_STACK_1
Main:       test-dpl

[test-fmm]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-fmm
Include:    %deployment %shared %logger %logger-hermes %logservice %evt-functions %fmm %pwm %servo
Defines:    -DDEBUG -DDEATH_STACK_1
Main:       test-fmm

#[test-homeone]
#Type:       test
#BoardId:    stm32f429zi_skyward_death_stack
#BinName:    test-homeone
#Include:    %shared
#Defines:    -DDEBUG
#Main:       test-homeone

## FSM tests


[test-ada-simulation]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-ada-simulation
Include:    %shared %deathstack %logger %pwm %xbee %piksi %servo %ada-test-sources
Defines:    -DSTANDALONE_CATCH1_TEST -DSDRAM_ISSI -DDEATH_STACK_2
Main:       catch/ada/ada_kalman_p/test-ada-simulation

[test-kalman-acc]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-kalman-acc
Include:    %shared %deathstack %logger %pwm %xbee %piksi %servo %kalman-test-sources
Defines:    -DSTANDALONE_CATCH1_TEST -DSDRAM_ISSI -DDEATH_STACK_2 -DDEBUG
Main:       catch/ada/kalman_acc/test-kalman-acc

# [test-deployment]
# Type:       test
# BoardId:    stm32f429zi_skyward_death_stack
# BinName:    test-deployment
# Include:    %deployment %shared %pwm %logger %logger-hermes %test-utils
# Defines:    -DSTANDALONE_CATCH1_TEST
# Main:       catch/fsm/test-deployment
#
# [test-ignition]
# Type: test
# BoardId: stm32f429zi_skyward_death_stack
# BinName: test-ignition
# Include:  %shared %ignition %logger %logger-hermes %canbus %canproxy %test-utils
# Defines: -DSTANDALONE_CATCH1_TEST
# Main: catch/fsm/test-ignition
#
# [test-fmm]
# Type:       test
# BoardId:    stm32f429zi_skyward_death_stack
# BinName:    test-fmm
# Include:    %shared %logger %logger-hermes %test-utils %fmm
# Defines:    -DSTANDALONE_CATCH1_TEST
# Main:       catch/fsm/test-fmm
#
[test-ada]
Type:       test
BoardId:    stm32f429zi_skyward_death_stack
BinName:    test-ada
Include:    %shared %logger %test-utils %deathstack %xbee
Defines:    -DSTANDALONE_CATCH1_TEST -DDEATH_STACK_2 -DSDRAM_ISSI -DDEBUG
Main:       catch/fsm/test-ada
